#summary How to add more queries.

== Introduction ==

Here we are going to cover adding your own statement to Rocksteady.  EPL(Esper Processing Language) is a language used in [http://esper.codehaus.org/ Esper], Rocksteady's choice of complex event processing engine.  EPL looks similar to SQL with "select", "from", or "where" in its syntax, the biggest difference between EPL and SQL is the data source.  In SQL, query is ran against data already stored in a database.  In EPL, query is ran against data as they arrive.

Case in point:

*SELECT `*` FROM metrics WHERE value > 80*

||SQL||Return all rows from a table named "metrics" where a field named "value" has a value larger than 80.  Data is in database.||
||EPL||Whenever new data arrive, query is executed and it will return all POJO(plain old java object) that has attribute named "value" larger than 80||

This, is how CEP process data in real time.  Because EPL processes  data as they come in, there are a few additional language feature that's applicable to EPL such as setting time window of the data.

== Details ==

When metrics come from application into MQ, Rocksteady consumes and parses the metrics into POJO(plain old java object) which is then feed into Esper CEP engine.  Esper will then run all the statements against this new pojo and what comes out depend on the statement.  It could be an aggregation statement which just add the value to existing value, or it could be a threshold statement which might trigger an email or Nagios alert or it could be a correlation statement which needs further processing by other statement.

Assuming we are using [MetricFormat default metric convention],

{{{retention.app_name.component+.colo.hostname value unix_timestamp}}}

these are the field name that's available to use in query.:

{{{
  private String original;
  private String retention = "";
  private String app = "";
  private String name;
  private String colo = "";
  private String hostname = "";
  private Double value;
  private Double timestamp;
}}}

So for metric string

{{{1min.juicer.system.cpu.prct_idle.dc1.pi101 82 1283192317}}}

||original||`1min.juicer.system.cpu.prct_idle.dc1.pi101 82 1283192317`||
||retention||1min||
||app||juicer||
||name||system.cpu.prct_idle||
||colo||dc1||
||hostname||pi101||
||value||82||
||timestamp||1283192317||